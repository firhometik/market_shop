<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>{$web.title}</title>
    <link rel="stylesheet" href="__BS__/css/bootstrap.min.css">
    <link rel="stylesheet" href="__CSS__/AdminLTE.min.css">
    <link rel="stylesheet" href="__CSS__/skins/_all-skins.min.css">
    <link rel="stylesheet" href="__CSS__/sweet-alert.css">
    <link rel="stylesheet" href="__CSS__/titatoggle-dist-min.css">
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="__JS__/jQuery-2.1.4.min.js"></script>
    <style>
        .headDropdown .dropdown-menu{min-width:145px;}
        .headDropdown .dropdown-menu a{font-size: 14px;padding:10px 20px;}
        .headDropdown .rightbtn{background: #D4DAE2}
        .contentListTitle .btnSearch{font-size:24px;position: absolute;right:30px;top:27px;color:#999;z-index: 9}
        .table tr > td:first-child,.table tr > th:first-child{padding-left: 20px;}
        .contentBoxTitle.smallBar .dropdown-menu{width:100%;background:#00a65a;border-radius: 4px;}
        .contentBoxTitle.smallBar .dropdown-menu a{color: #fff}
        .contentBoxTitle.smallBar .dropdown-menu a:hover{background
        :#008d4c}
        .contentBoxTitle.smallBar .headDropdown{position: relative;}
        .table.contentList > tbody > tr.contentItem > td{padding:7px 10px;color:#999;word-break: break-all}
        .contentList .title{color:#555;display:block;height:14px;overflow: hidden}
        .contentList .img{margin-right: -10px;}
        .contentList.table > tbody > tr.contentItem > td.arow{line-height: 36px;}


        .contentList .edittd{position: relative;}
        .contentList .editbox{width:36px;height:36px;position: absolute;top:7px;right:85px;display: none;}
        .contentList .edittd i.iconfont.del{color:#d73925;}
        .contentList .contentItem i.iconfont{width:36px;height:36px;line-height: 36px;float:left;text-align: center;cursor:pointer;background: none}
        .contentList .edittd:hover i.iconfont.edit{background:#367fa9;color:#fff;}
        .contentList .edittd:hover i.iconfont.del{background:#dd4b39;color:#fff;}
        .contentList .edittd:hover i.iconfont.edit:hover{background:#32779E;color:#fff;}
        .contentList .edittd:hover i.iconfont.del:hover{background:#d73925;color:#fff;}

        .contentList .edittd:hover .editbox{display: block;}
        .contentList i.iconfont.put{background:#00a65a;color:#fff;font-size: 16px;}
        .contentList i.iconfont.put:hover{background:#008d4c;}
        .contentList i.iconfont.com{background:#2aabd2;color:#fff; }
        .contentList i.iconfont.com:hover{background:#269abc;}


        .contentList .th-oper{padding-left: 20px}
        .contentList .checkbox{margin-left: 10px;margin-bottom: 0;margin-top: 8px;}

        .contentBoxTitle.smallBar .dropdown-menu{width:100%;background:#00a65a;border-radius: 4px;}
        .contentBoxTitle.smallBar .dropdown-menu a{color: #fff}
        .contentBoxTitle.smallBar .dropdown-menu a:hover{background
        :#008d4c}
        .contentBoxTitle.smallBar .headDropdown{position: relative;}
        .contentBoxTitle .search{position: absolute;left:0;top:20;margin-left: 20px;}
        .contentBoxTitle .search .dropdown-toggle{border-radius: 0;background:#fff;width:141px;}
        .contentBoxTitle .dropdown-menu{width:460px;}
        .contentBoxTitle.contentListTitle .dropdown-menu li a{display: inline-block;font-size: 14px;}
        .contentBoxTitle .dropdown-menu li a.on{background:#367fa9;color:#fff;}
        #search_key:focus{position: relative;}
        .checkAll{top:-4px;margin-left: 10px;margin-right: 20px;}
        .searchUserID{width:180px;margin-right: 15px;float: left}
        .searchTime{width:150px;margin-right: -1px;float: left;position: relative;}
        .searchBtn{margin-left: 5px;float: left;}
        .pagination{margin-right: 10px;}
        h5 .pull-right{margin-left: 10px;}

        .contentRightBox{padding:5px 0;}
        .contentRightBox .tab-pane{padding:5px 20px;}
        .contentRightBox .nav > li > a{padding:5px 20px;border-bottom: 1px solid #ddd;color:#999;}
        .contentRightBox .nav-tabs > li.active > a{border-color:#fff;border-bottom: 2px solid #367fa9;color:#367fa9;padding-bottom: 4px;}
        .contentRightBox .nav > li > a:hover{border-color: #fff;background:#fff;border-bottom: 1px solid #999;}
        .operList > div{padding:6px 0;}
        .btn-group .ms-sel-ctn{padding:3px;}
        .btn-group .form-control{border-radius: 2px;}
        .btn-move{border-radius: 0}
        .btn-del,.contentBind {border-top-left-radius: 0;border-bottom-left-radius: 0}
        .widget_sider{position: absolute;}
        .widget_sider .sider{line-height: 1.4em;top:26px;}
        #move{min-width: 200px;}
        #move a{height:21px;overflow: hidden}
        #move .ListTree{width:11px;margin-right: 6px;}

        .cateList .text-primary{font-weight: bold;}
    </style>
</head>
<body class="hold-transition skin-blue sidebar-mini {$web.sidebar_collapse}">
<div class="wrapper">
    <header class="main-header">
      {include file="public/left" /}
    </header>

    <div class="content-wrapper">
        <section class="content-header">
            <h1>

                 生活分类管理
                <small>
                    <ol class="breadcrumb">
                        <li>
                            <a href="{:url('Index/index')}"><i class="iconfont">&#xe615;</i> 后台首页</a>
                        </li>
                        <li>
                            生活分类管理
                        </li>

                    </ol>
                </small>

            </h1>
        </section>
        <section class="content">
            <div class="row">
                <div class="col-lg-12">
                    <div class="box-body box box-none no-padding">
                        <div class="contentBoxTitle contentListTitle">
                            <input type="text" class="form-control input-lg pull" id='search_key' name='key' value="" placeholder="输入标题关键字或ID">
                            <i class="iconfont btnSearch hand" id='search'>&#xe608;</i>
                        </div>
                        <div class="table-responsive mailbox-messages">
                            <table class="table table-hover table-striped contentList">
                                <thead>
                                <tr>
                                <th  class='maxtable'></th>
                                <th >ID</th>
                                <th >分类</th>
                                <th >排序序号</th>
                                <th >新增时间</th>
                                <th >发布状态</th>
                                <th >操作</th>
                                </tr>
                                </thead>
                                <tbody>
                                {volist name='category' id='rs'}
                                <tr class="mailbox-subject contentItem" id='contentListItem-{$rs.id}'>
                                    <td class='maxtable'>
                                        <div class="checkbox checkbox-slider--b-errya">
                                            <label>
                                                <input type="checkbox" class='checkItem' data='{$rs.id}'/><span></span>
                                            </label>
                                        </div>
                                    </td>
                                    <td>{$rs.id}</td>
                                    <td>{$rs.name}</td>
                                    <td class="listorder">
                                        <input size="3" attr-id="{$rs.id}" name="listorder" value="{$rs.listorder}"></input>
                                    </td>
                                    <td>{$rs.create_time}</td>
                                    <td class="td-status">
                                        <a href="{:url('category/status',['id'=>$rs.id,'status'=>1])}" title="点击修改状态">{$rs.status|status}</a>
                                    </td>
                                    <td class="td-manage">
                                        <a href="{:url('category/index',['parent_id'=>$rs.id])}" style="float: left;line-height: 36px;">获取子栏目</a>
                                        <a style="text-decoration:none" class="ml-5" data-toggle="modal" data-target="#Modal" data-remote="/Category/getCategory/id/{$rs.id}" href="javascript:;" title="编辑"><i class="iconfont edit" data='{$rs.id}'>&#xe648;</i></a> 
                                        <a style="text-decoration:none" class="ml-5" onClick="o2o_del('{:url("Category/delcategory",['id'=>$rs.id])}','')" href="javascript:;" title="删除"><i class="iconfont del">&#xe649;</i></a>
                                    </td>
                                </tr>
                                {/volist}
                                </tbody>
                            </table>
                        </div><!-- /.mail-box-messages -->
                        <div class="box-header  with-border">
                            <div class='pull-left'>
                                <div class="checkbox checkbox-slider--b-errya pull-left checkAll" >
                                    <label>
                                        <input type="checkbox" id='checkall' /><span></span>
                                    </label>
                                </div>
                                <div class="pull-left xmr">
                                    <button class="btn btn-danger btn-sm contentDel" >
                                        移除
                                    </button>
                                    <button class="btn btn-success btn-sm contentDel" data-toggle="modal" data-target="#Modal" data-remote="/Category/getCategory" >
                                        添加广告内容
                                    </button>
                                </div>
                            </div>
                            <ul class="pagination pull-right ">
                                <li class='paginate_button '>
                                    <a href=''>}</a>
                                </li>
                            </ul>
                        </div>
                    </div><!-- /.box-body -->
                </div>

            </div>
        </section>


    </div>
    {include file="Public/footer" /}
</div><!-- ./wrapper -->
<script>
    $(function(){

        $("#checkall").change(function(){
            var type = $(this).prop('checked');
            $("input.checkItem").prop('checked',type);
            getSelectContentID();
        })

        //审核操作
        $('#audit a').click(function(){
            var type = $(this).attr("data");
            var id = getSelectContentID();
            setAudit(id,type)
        })

        //移动操作
        $("#move a").click(function(){
            var cate = $(this).attr("data");
            var p = getSelectContentID(true);
            var idlist = p[0];
            var catelist = p[1];
            if(idlist && catelist)
            {
                $.getJSON("/Setting/moveContentCategory/cate/"+cate+"/idlist/"+idlist+"/catelist/"+catelist,function(e){
                    if(e.status)
                    {
                        $(".modal").modal('hide');
                        swal({title:"Good job!",text: e.info,type: "success"},function(isConfirm){
                            window.location.href = "/Setting/content/id/"+cate;
                        });
                    }else
                    {
                        swal("So sad!", e.info, "error")
                    }
                });
            }
        });

        //删除操作
        $("button.contentDel").click(function(){
            var p = getSelectContentID();
            setDel(p)
        });


        $("#search-dropdown-menu").click(function(e){
            if($(e.target)[0].tagName != "A")
                return false;
        })

        $("#search").click(function(){
            var val = $("#search_key").val();
            putKey(val);
        })
        $("#search_key").keypress(function(e) {
            if(e.which == 13) {
                var val = $("#search_key").val();
                putKey(val);
            }
        });

        //绑定
        $(".contentBind").click(function(){
            var id = $("input[name='contentbindid']").val();
            var cate = '';
            if(id &&　cate)
            {
                $.getJSON("/Setting/bindContentCategory/id/"+id+"/cate/"+cate+"/type/1",function(e){
                    if(e.status)
                    {
                        $(".modal").modal('hide');
                        swal({title:"Good job!",text: e.info,type: "success"},function(isConfirm){
                            window.location.reload();
                        });
                    }else
                    {
                        swal("So sad!", e.info, "error")
                    }
                });
            }
        })
    })

    function setDel(id)
    {
        if(!id) return false;

        var url = '/Setting/delTopicsCommend/id/'+id;
        $.getJSON(url,function(e){

            swal(
                    {
                        title: "Are you sure?",
                        text: e.info,
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: "确定",
                        cancelButtonText: "放弃",
                        closeOnConfirm: false
                    },
                    function(isConfirm)
                    {
                        if(isConfirm)
                        {
                            $.getJSON(e.url,function(re){
                                if(re.status == 1)
                                {
                                    window.location.reload();
                                }else
                                {
                                    swal("So sad!", re.info, "error");
                                }
                            })
                        }
                    }
            );

        })
    }

    function getSelectContentID()
    {
        var check = new Array();
        $("input.checkItem:checked").each(function(){
            check.push($(this).attr("data"));
        });
        return check.join(",");

    }
</script>
</body>
</html>
