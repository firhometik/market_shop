<!--包含头部文件-->
{include file="public/header" /}
<link rel="stylesheet" type="text/css" href='__FCSS__/webuploader.css'>
<style type="text/css">
	h3{margin-top: 0;padding-bottom:20px;margin-bottom: 40px;border-bottom: 1px dashed #d7d7d7;padding-top: 40px;}
	.photo{list-style: none}
    .photo li{float: left;margin-right: 30px;}
    .photo li:nth-child(4n){margin-right: 0}
    .photo img{width: 90px;height: 80px;}
    .z_photo{
        width: 90px;
        height: 80px;
        background: url(__JIMG__/sjzp1.jpg);
        background-size: 100%;
        background-repeat: round;
    }
    #picker{float: left}
</style>
<div class="cl pd-5 bg-1 bk-gray mt-20"> <h1 style="text-align: center;">商户入驻申请</h1></div>
<article class="page-container">
	<form class="form form-horizontal"  method="post" action="">
		<h3 style="padding-top:0">
	        <span> 基本信息：</span> 
		</h3>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商户名称：</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="请输入商户名称" id="" name="name">
			</div>
		</div>
		
		<div class="row cl city">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>所属城市：</label>
			<div class="formControls col-xs-8 col-sm-2"> 
				<span class="select-box">
				<select name="city_id" class="select cityId">
					<option value="0">--请选择--</option>
					{volist name='city' id="vo"}
					<option value="{$vo.area_no}">{$vo.area_name}</option>
					{/volist}
				</select>
				</span>
			</div>
		</div>
		
		<div class="row cl">
              <label class="form-label col-xs-4 col-sm-2">缩略图：</label>
              <div class="formControls col-xs-8 col-sm-9">
              	<ul class="photo">
                </ul>
                <div  id="picker"></div>
                <!-- <input id="file_upload"  type="file" multiple="true" >
                <img style="display: none" id="upload_org_code_img" src="" width="150" height="150">
                <input id="file_upload_image" name="logo" type="hidden" multiple="true" value=""> -->
              </div>
        </div>
        <div class="row cl">
              <label class="form-label col-xs-4 col-sm-2">营业执照：</label>
              <div class="formControls col-xs-8 col-sm-9">
                <input id="file_upload_other"  type="file" multiple="true" >
                <img style="display: none" id="upload_org_code_img_other" src="" width="150" height="150">
                <input id="file_upload_image_other" name="licence_logo" type="hidden" multiple="true" value="">
              </div>
        </div>
        
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">商户介绍：</label>
			<div class="formControls col-xs-8 col-sm-9"> 
				<script id="editor1"  type="text/plain" name="description" style="width:80%;height:300px;"></script> 
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">银行账号:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="bank_info">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">开户行名称:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="bank_name">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">开户行姓名:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="bank_user">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">法人:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="faren">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">法人电话:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="faren_tel">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>邮箱：</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="email">
			</div>
		</div>
		<h3 style="padding-top:0">
	        <span> 总店信息：</span> 
		</h3>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">电话:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="tel">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">联系人:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="contact">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>所属分类：</label>
			<div class="formControls col-xs-8 col-sm-3"> <span class="select-box">
				<select name="category_id" class="select categoryId">
					<option value="0">--请选择--</option>
					{volist name='category' id="vo"}
					<option value="{$vo.id}">{$vo.name}</option>
					{/volist}
					
				</select>
				</span> 
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">所属子类：</label>
			<div class="formControls col-xs-8 col-sm-3 skin-minimal">
				<div class="check-box se_category_id">

				</div>
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">商户地址：</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="address">
			</div>
			<a  class="btn btn-default radius ml-10 maptag">标注</a>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">营业时间:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="open_time">
			</div>
		</div>
		
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">门店简介：</label>
			<div class="formControls col-xs-8 col-sm-9"> 
				<script id="editor"  type="text/plain" name="content" style="width:80%;height:300px;"></script> 
			</div>
		</div>
		<h3 style="padding-top:0">
	        <span> 账号信息：</span> 
		</h3>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">用户名:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="text" class="input-text" value="" placeholder="" id="" name="username">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2">密码:</label>
			<div class="formControls col-xs-8 col-sm-3">
				<input type="password" class="input-text" value="" placeholder="" id="" name="password">
			</div>
		</div>
		
		<div class="row cl">
			<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
				<button  class="btn btn-primary radius" type="submit"><i class="Hui-iconfont">&#xe632;</i> 申请</button>	
			</div>
		</div>
	</form>
</article>

<!--包含尾部文件-->
{include file="public/footer" /}
<script type="text/javascript" src="__FHI__/lib/ueditor/1.4.3/ueditor.config.js"></script>
<script type="text/javascript" src="__FHI__/lib/ueditor/1.4.3/ueditor.all.min.js"> </script>
<script type="text/javascript" src="__FHI__/lib/ueditor/1.4.3/lang/zh-cn/zh-cn.js"></script>
 <script type="text/javascript" src="__FJS__/webuploader.min.js"></script>
<!--分配编辑器-->
<script>
$(function(){
	var ue = UE.getEditor('editor');
	var ue1 = UE.getEditor('editor1');
});
</script>
<script type="text/javascript">
	var SCOPE = {
		'category_url':'{:url("api/category/getCategoryID")}',
		'city_url':'{:url("api/city/getCityParent")}'
	}
	$('.categoryId').change(function(){
		let categoryId = $(this).val();
		let url = SCOPE.category_url;
		let postData = {'id':categoryId};
		$.post(url,postData,function(e){
			let a = $.parseJSON(e);
			console.log(a);
			if (a.code == 200) {
				let data = a.data;
				let category_html = '';
				$(data).each(function(i){
					category_html +="<input name='se_category_id[]' type='checkbox' value='"+this.id+"' id='checkbox-moban'/>"+this.name;
					category_html +="<label for='chekbox-moban'>&nbsp;</label>";
				});
				$('.se_category_id').html(category_html);
			}else{
				$('.se_category_id').html('');
			}
		})
	});
	
	// $(funcion(){
		$('.cityId').change(function(){
			let cityId = $(this).val();
			let url = SCOPE.city_url;
			let postData = {'id':cityId};
			$.post(url,postData,function(e){
				let a = $.parseJSON(e);
				if (a.code == 200) {
					let lid = $('#levle2');
					if (lid) {
						$('#levle2').remove();
					}
					let tid = $('#levle3');
					if (tid) {
						$('#levle3').remove();
					}
					let data = a.data;
					let city_html = '';
					city_html += '<div class="formControls col-xs-8 col-sm-2" id="levle2"><span class="select-box">';
					city_html += '<select name="se_city_id" class="select se_city_id city_level" id="city_level">';
					city_html += '<option value="" >请选择</option>';
					$(data).each(function(i){
						city_html +="<option value='"+this.area_no+"'>"+this.area_name+"</option>";
					});
					city_html += '</select></span>';
					$('.city').append(city_html);
				}else{
					$('.se_category_id').html('');
				}
			})
		});
		$(document).on("change", "#city_level", function() {
		// $('#city_level').on('change','select',function(){
			console.log('1');
			let cityId = $(this).val();
			let url = SCOPE.city_url;
			let postData = {'id':cityId};
			$.post(url,postData,function(e){
				let a = $.parseJSON(e);
				if (a.code == 200) {
					let lid = $('#levle3');
					if (lid) {
						$('#levle3').remove();
					}
					let data = a.data;
					let city_html = '';
					city_html += '<div class="formControls col-xs-8 col-sm-2" id="levle3"><span class="select-box">';
					city_html += '<select name="se_city_id" class="select se_city_id city_levels">';
					city_html += '<option value="" >请选择</option>';
					$(data).each(function(i){
						city_html +="<option value='"+this.area_no+"'>"+this.area_name+"</option>";
					});
					city_html += '</select></span>';
					$('.city').append(city_html);
				}else{
					$('.se_category_id').html('');
				}
			})
		});
	// })
	
</script>
<script type="text/javascript">
	jQuery(function(){
        $ = jQuery;
		$list = $('.photo');
	    if($('.z_addImg').length>0){
	        $('#picker').hide();
	        $('.photo').click(function(){$('#picker').find('input[type=file]').trigger('click')})
	    }
	    var uploader = WebUploader.create({

	        // 选完文件后，是否自动上传。
	        auto: true,

	        // swf文件路径

	        // 文件接收服务端。
	        server: '{:url("api/image/upload")}',
	        fileVal: 'file',
	        duplicate: true,
	        // 选择文件的按钮。可选。
	        // 内部根据当前运行是创建，可能是input元素，也可能是flash.
	        pick: {
	            id: '#picker',
	            label: '<div class="z_photo"></div>'
	        },

	        // 只允许选择图片文件。
	        accept: {
	            title: 'Images',
	            extensions: 'gif,jpg,jpeg,bmp,png',
	            mimeTypes: 'image/*'
	        }
	    });
	 //    uploader.on('uploadBeforeSend', function(obj, data, headers) {
		// 	_.extend(headers, {
		// 	"Origin": '{:url("api/image/upload")}',
		// 	"Access-Control-Request-Method": "POST"
		// 	});
		// });
	    // 当有文件添加进来的时候
	    uploader.on('fileQueued', function (file) {
	        var $li = $('<li id="' + file.id + '" class="z_addImg"><img></li>'),
	                $img = $li.find('img');


	        // $list为容器jQuery实例
	        $list.html('').append($li);
	        $('#picker').hide();        
	        // 创建缩略图
	        // 如果为非图片文件，可以不用调用此方法。
	        // thumbnailWidth x thumbnailHeight 为 100 x 100
	        uploader.makeThumb(file, function (error, src) {
	            if (error) {
	                $img.replaceWith('<span>不能预览</span>');
	                return;
	            }

	            $img.attr('src', src);
	        }, 100, 100);
	    });
	    // 文件上传过程中创建进度条实时显示。//完成时p=1
	    uploader.on('uploadProgress', function (file, percentage) {
	    });

	    // 文件上传成功，给item添加成功class, 用样式标记上传成功。
	    uploader.on('uploadSuccess', function (file, rs) {
	        $('#' + file.id).addClass('upload-state-done');
	        $('#' + file.id).attr('data-src',rs.subName);
	        $('input[name="user_head"]').val(rs.subName);            


	    });

	    // 文件上传失败，显示上传出错。
	    uploader.on('uploadError', function (file) {
	        alert('上传失败,请重新上传');
	        $list.html('');
	        $('#picker').show();
	    });

	    // 完成上传完了，成功或者失败，先删除进度条。
	    uploader.on('uploadComplete', function (file) {
	    });
	});
</script>
</body>
</html>